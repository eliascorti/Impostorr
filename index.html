<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Impostorr - Juego del impostor</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet" />
  </head>
  <body>
    <div class="app">
      <header class="hero">
        <h1>Impostorr</h1>
        <p class="tagline">El juego social para descubrir al impostor sin revelar la palabra secreta.</p>
      </header>

      <main>
        <section id="mode-select" class="card">
          <h2>Modo de juego</h2>
          <p>Elegí si quieren jugar compartiendo un solo dispositivo o conectándose en línea con un código de sala.</p>
          <div class="mode-options" role="radiogroup" aria-label="Modo de juego">
            <label class="mode-option">
              <input type="radio" name="game-mode" id="mode-local" value="local" checked />
              <span class="mode-label">Mismo dispositivo</span>
            </label>
            <label class="mode-option">
              <input type="radio" name="game-mode" id="mode-online" value="online" />
              <span class="mode-label">En línea</span>
            </label>
          </div>
        </section>

        <section id="setup" class="card">
          <h2>Configurar partida</h2>
          <form id="setup-form">
            <label for="players">Cantidad de jugadores</label>
            <input type="number" id="players" min="3" max="20" value="5" required />

            <div class="names-field">
              <span class="field-label">Nombres de los jugadores</span>
              <div id="player-names" class="player-names"></div>
            </div>

            <label for="category">Categoría</label>
            <select id="category" required></select>

            <button type="submit" class="primary">Comenzar ronda</button>
          </form>
        </section>

        <section id="round" class="card hidden" aria-live="polite">
          <div class="round-header">
            <h2 id="round-title">Turno del jugador</h2>
            <button id="reset" class="secondary">Nueva ronda</button>
          </div>
          <p id="instructions">Pasa el dispositivo al jugador <span id="current-player">1</span>. Cuando esté listo, presiona "Mostrar" para revelar su rol. Después presiona "Ocultar" y pasa el dispositivo.</p>

          <div class="reveal">
            <button id="toggle-word" class="primary">Mostrar</button>
            <div id="word" class="word" aria-live="assertive"></div>
            <div id="word-visual" class="word-visual hidden">
              <img id="word-image" alt="" />
              <p id="word-caption"></p>
            </div>
          </div>

          <div class="round-info">
            <p><strong>Categoría:</strong> <span id="round-category"></span></p>
          </div>

          <div id="voting" class="voting">
            <h3>Votación</h3>
            <p id="vote-intro">Cuando terminen de debatir, inicien la votación secreta.</p>
            <button id="start-vote" type="button" class="primary">Comenzar votación</button>

            <div id="vote-panel" class="hidden">
              <p id="vote-instructions"></p>
              <form id="vote-form">
                <label for="vote-choice" id="vote-label">Selecciona a quién acusas</label>
                <select id="vote-choice" required></select>
                <button type="submit" class="primary">Registrar voto</button>
              </form>
            </div>

            <div id="vote-result" class="hidden">
              <p id="vote-summary" class="vote-summary"></p>
              <p id="vote-outcome" class="vote-outcome"></p>
            </div>
          </div>
        </section>

        <section id="online-setup" class="card hidden">
          <h2>Juego en línea</h2>
          <p class="online-intro">Creá una sala como anfitrión o ingresá el código que te compartieron para sumarte desde tu teléfono.</p>

          <div class="online-choice">
            <button id="choose-host" type="button" class="primary">Crear sala</button>
            <button id="choose-join" type="button" class="secondary">Unirse a sala</button>
          </div>

          <div id="online-host-setup" class="online-pane hidden">
            <h3>Crear una sala nueva</h3>
            <p>Generá un código y compartilo con tus amigos para que se conecten. Podés agregar un nombre público para identificarte.</p>
            <label for="host-name">Nombre del anfitrión (opcional)</label>
            <input type="text" id="host-name" maxlength="30" placeholder="Anfitrión" />
            <button id="create-room" type="button" class="primary">Generar código de sala</button>
            <div id="room-details" class="room-details hidden">
              <p>Código de sala: <span id="room-code" class="room-code"></span></p>
              <div class="room-actions">
                <button id="copy-room" type="button" class="secondary">Copiar código</button>
                <button id="close-room" type="button" class="secondary">Cerrar sala</button>
              </div>
            </div>
          </div>

          <div id="online-join-setup" class="online-pane hidden">
            <h3>Unirse a una sala</h3>
            <form id="join-form" autocomplete="off">
              <label for="join-code">Código de sala</label>
              <input type="text" id="join-code" maxlength="32" placeholder="Ej: imp-1234" required />
              <label for="join-name">Tu nombre</label>
              <input type="text" id="join-name" maxlength="30" placeholder="Cómo te llamás" required />
              <button type="submit" class="primary">Unirse</button>
            </form>
            <div id="join-feedback" class="message-stack"></div>
          </div>
        </section>

        <section id="online-host-card" class="card hidden">
          <div class="host-header">
            <h2>Panel del anfitrión</h2>
            <p id="host-room-label" class="host-room-label"></p>
          </div>
          <div class="host-meta">
            <p class="host-name" id="host-display-name"></p>
          </div>
          <div class="host-players">
            <h3>Jugadores conectados</h3>
            <ul id="online-player-list" class="player-list"></ul>
            <p id="host-empty" class="muted">Esperando a que se conecten jugadores...</p>
          </div>
          <div class="host-controls">
            <label for="online-category">Categoría</label>
            <select id="online-category"></select>
            <button id="host-start-round" type="button" class="primary" disabled>Iniciar ronda</button>
            <button id="host-open-vote" type="button" class="primary hidden" disabled>Abrir votación</button>
            <button id="host-end-round" type="button" class="secondary hidden">Terminar ronda</button>
          </div>
          <div id="host-round-info" class="host-round-info hidden">
            <p><strong>Categoría:</strong> <span id="host-round-category"></span></p>
            <p><strong>Palabra secreta:</strong> <span id="host-round-word"></span></p>
            <p><strong>Impostor asignado:</strong> <span id="host-round-impostor"></span></p>
          </div>
          <div id="host-messages" class="message-stack"></div>
        </section>

        <section id="online-player-card" class="card hidden" aria-live="polite">
          <h2 id="player-card-title">Sala en línea</h2>
          <div id="player-messages" class="message-stack"></div>

          <div id="player-role-panel" class="player-role hidden">
            <p id="player-role-text"></p>
            <button id="player-toggle-word" type="button" class="primary">Mostrar</button>
            <div id="player-word-wrapper" class="player-word-wrapper hidden">
              <div id="player-word" class="word"></div>
              <div id="player-word-visual" class="word-visual hidden">
                <img id="player-word-image" alt="" />
                <p id="player-word-caption"></p>
              </div>
            </div>
          </div>

          <div id="player-vote-panel" class="player-vote hidden">
            <p id="player-vote-instructions"></p>
            <form id="player-vote-form">
              <label for="player-vote-choice" id="player-vote-label">Seleccioná tu acusación</label>
              <select id="player-vote-choice" required></select>
              <button type="submit" class="primary">Enviar voto</button>
            </form>
          </div>

          <button id="player-leave" type="button" class="secondary leave-button">Salir de la sala</button>
        </section>

        <section class="card about">
          <h2>Cómo jugar</h2>
          <ol>
            <li>Elige la cantidad de jugadores y la categoría con la que quieren jugar.</li>
            <li>Una vez iniciada la ronda, pasa el dispositivo. Cada jugador presiona "Mostrar" para ver su palabra.</li>
            <li>Todos menos uno verán la misma palabra. A la persona que le toque "Impostor" deberá fingir saberla.</li>
            <li>Conversen dando pistas sin revelar la palabra exacta. Al final voten quién creen que es el impostor.</li>
            <li>Sigan votando hasta atrapar al impostor. Si quedan dos personas y el impostor sigue libre, la ronda termina.</li>
          </ol>
        </section>
      </main>

      <footer>
        <p>Hecho con ❤ para reuniones inolvidables. Todos los derechos me pertenecen: elxortiCreations.</p>
      </footer>
    </div>

    <!-- Define la URL de tu servidor Socket.IO aquí -->
    <!-- Carga Socket.IO (sin 'integrity' para evitar bloqueos) -->
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js" crossorigin="anonymous"></script>

    <!-- Define la URL de tu servidor Socket.IO -->
    <script>
      window.IMPOSTORX_SOCKET_URL = "https://impostorr.onrender.com";
    </script>

    <!-- Tu código del juego -->
    <script src="script.js"></script>
  </body>
</html>
